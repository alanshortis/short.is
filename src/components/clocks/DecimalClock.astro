---
interface Props {
  isLarge?: boolean;
}

const { isLarge } = Astro.props;
---

<decimal-clock class={`time ${isLarge ? 'time--large' : ''}`}>
  <span class="js-time">0:00:00</span>
</decimal-clock>

<script>
  import type { DecimalTime } from '../../shared-types';
  import SharedDecimalClockManager from '../../workers/decimal-clock';

  class DecimalClock extends HTMLElement {
    private sharedManager: SharedDecimalClockManager;
    private timeSpan: HTMLSpanElement;
    private pad: (num: number) => string;
    private timeUpdateCallback: (decimalTime: DecimalTime) => void;

    constructor() {
      super();
      this.sharedManager = SharedDecimalClockManager.getInstance();
      this.timeSpan = this.querySelector('.js-time') as HTMLSpanElement;

      this.pad = (num: number) => num.toString().padStart(2, '0');

      this.timeUpdateCallback = (decimalTime: DecimalTime) => {
        this.setDecimalTime(decimalTime);
      };

      this.sharedManager.subscribe(this.timeUpdateCallback);
    }

    disconnectedCallback() {
      this.sharedManager.unsubscribe(this.timeUpdateCallback);
    }

    private setDecimalTime(decimalTime: DecimalTime): void {
      const { hours, minutes, seconds } = decimalTime;
      const formattedTime = `${hours}:${this.pad(minutes)}:${this.pad(seconds)}`;
      this.timeSpan.textContent = formattedTime;
    }
  }

  customElements.define('decimal-clock', DecimalClock);
</script>

<style lang="scss">
  @use '../../styles/mixins' as *;

  .time {
    @include label;
    &--large {
      font-size: var(--step-2);
    }
    &__label {
      @include visually-hidden;
    }
  }
</style>
